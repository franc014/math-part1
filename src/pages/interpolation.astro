---
import Layout from '../layouts/Layout.astro';
---
<Layout title="Interpolation">
		<canvas class="canvas"></canvas>
</Layout>

<script>
	const canvas = document.querySelector('.canvas');
	const bluviolet = {
		r: 39,
		g: 31,
		b: 110
	};
	const PaleGoldenRod = {
		r: 238,
		g: 232,
		b: 170
	};
	
	const A = {
		x: 	200,
		y:  200
	};
	const B = {
		x: 	500,
		y: 	100
	};
	const lowFrequency = 200;
	const highFrequency = 400;

	canvas.width = window.innerWidth;
	canvas.height  = window.innerHeight;
	const ctx = canvas.getContext('2d');
	let audioContext = null;
	let oscilator = null;

	
	
	canvas.addEventListener('click', function() {
		if (!audioContext) {
			audioContext = new (AudioContext || webkitAudioContext || window.webkitAudioContext)();
			oscilator = audioContext.createOscillator();
			oscilator.frequency.value = 500;
			oscilator.start();

			const node = audioContext.createGain();
			node.gain.value = 0.5;
			oscilator.connect(node);
			node.connect(audioContext.destination);	
		}else {
			
			oscilator.disconnect();
			oscilator.stop();
			audioContext = null;
			oscilator = null;

		}
	});

	
	function drawDot(v,label) {
		ctx.beginPath();
		ctx.fillStyle = 'white';
		ctx.strokeStyle = 'greenyellow';
		ctx.strokowWidth = 5;
		ctx.arc(v.x, v.y, 15, 0, Math.PI*2, true);

		ctx.fill();
		ctx.stroke();
		ctx.fillStyle = 'black';
		ctx.textAlign = 'center';
		ctx.textBaseline = 'middle';
		ctx.font = 'bold 10px Arial';
		ctx.fillText(label, v.x, v.y);
	}

	function animate(){
		
		ctx.clearRect(0,0,canvas.width,canvas.height);
		
		const sec = new Date().getTime() / 1000;
		const t = (Math.sin(sec*Math.PI) + 1) / 2;//sec - Math.floor(sec);
		
		const C = vLerpV2(A, B, t);
		drawDot(C,'lerp');
		drawDot(A,'A');
		drawDot(B,'B');

		//interpolate colors
		//canvas.style.backgroundColor = `rgb(${blue.r},${blue.g},${blue.b})`;

		const color = vLerpV2(bluviolet, PaleGoldenRod, t);
		//console.log(color);
		canvas.style.backgroundColor = `rgba(${color.r},${color.g},${color.b},0.8)`;

		if (oscilator) {
			oscilator.frequency.value = lerp(lowFrequency, highFrequency, t);
		}

		ctx.strokeStyle = 'lemonchiffon';
		ctx.setLineDash([lerp(4, 20, t), lerp(3, 70, t)]);
		ctx.textAlign = 'center';
		ctx.textBaseline = 'top';
		ctx.font = 'bold 40px Arial';
		ctx.strokeText('Click for sound', canvas.width/2, 10);
		
		ctx.fillStyle = `rgba(70,59,161,${lerp(0, 0.8, t)})`;
		ctx.fillText('Click for sound', canvas.width/2, 10);
		ctx.setLineDash([]);

		requestAnimationFrame(animate);
	}

	function lerp(a,b,t) {
		return a + (b - a) * t;
	}

	function vLerpV2(A,B,t) {
		const res = {};

		for(let k in A) {
			res[k] = lerp(A[k], B[k], t);
		}

		return res;
	}

	
	animate();
	
	

</script>




